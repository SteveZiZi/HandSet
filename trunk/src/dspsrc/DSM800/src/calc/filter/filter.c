#include "filter.h"

// 4k,5k,8k,10k,12.8k
float a40_70Hz[5][3][3]={
    {
        {1,   -1.985005779735,   0.9924416678997},    
        {1,   -1.984816797278,   0.9962444862365},
        {1,   -1.991957811041,   0.9962705241537}
    },
    {
        {1,    -1.98636798556,    0.991135142776},
        {1,    -1.99294716158,   0.9956820280264},
        {1,   -1.988280860655,   0.9956416187935}
    },
    {
        {1,   -1.994362890484,   0.9962270890169},
        {1,   -1.995253481612,   0.9981142602302},
        {1,   -1.997042237652,   0.9981224318698}	
    },
    {
        {1,   -1.995564699874,    0.997279867788},
        {1,   -1.996421139299,   0.9971944600824},
        {1,  -0.9626277178831,   0.1957297825559}
    },
    {
        {1,   -1.996192839616,   0.9966595936838},
        {1,   -1.995724857287,   0.9967835721477},
        {1,  -0.7018968021811,  0.08997803289491}  
    }
};

float b40_70Hz[5][3][3]={
    {
        {1,   0.5900607301749,  0.07727989082919},
        {1,    -1.9271536121,   0.9272401918026},    
        {1,    -1.49967250487,   0.7689904292722}
    },
    {
        {1,   -1.903375690723,   0.9581113093059},
        {1,   -1.327368710085,   0.3544308362053},
        {1,   -1.038648515581,  0.04253011331414}
    },
    {
        {1,  -0.3392441327123,  0.01742048165575},
        {1,   -1.488777325884,   0.5380593763512},
        {1,   -1.949932415428,   0.9499829462313}	
    },
    {
        {1,   -1.899493402183,   0.9184494030543},
        {1,   -1.802774377692,   0.8028820834225},
        {1,    -3.48600146624,    4.513590822931}
    },
    {		
        {1,   -1.913784763341,   0.9227799244182},
        {1,   -1.672237124508,   0.6722846099003},
        {1,   -0.01733728022456,  0.09879082640311}
    }
};

float g40_70Hz[5] = {
    2.725580258388e-006,        // 4k
    2.44273597532e-005,         // 5k
    1.805524154077e-006,        // 8k
    0.0001200497501492,         // 10k
    0.0003196134546569			// 12.8k, Wpass:2
};
IIR_State_6order iir_state;
void iir_6th_filter(const float * pcmIn, float (*a)[3], float (*b)[3], 
	float gain, IIR_State_6order* filter_state, int sample_size, float *pcmOut)
{
     float x1, x2, x3, Tmp_f00, Tmp_f10, Tmp_f20;
     int i;
     float Tmp_pcm;
     for (i = 0; i < sample_size; i++)
     {
         Tmp_pcm = pcmIn[i];
         Tmp_f00 = Tmp_pcm - a[0][1] * filter_state->w01 - a[0][2] * filter_state->w02;
         x1 = Tmp_f00 * b[0][0] + b[0][1] * filter_state->w01 + b[0][2] * filter_state->w02;
         
         filter_state->w02 = filter_state->w01;
         filter_state->w01 = Tmp_f00;
         x1 = gain * x1;
         
         Tmp_f10 = x1 - a[1][1] * filter_state->w11 - a[1][2] * filter_state->w12;
         x2 = Tmp_f10 * b[1][0] + b[1][1] * filter_state->w11 + b[1][2] * filter_state->w12;
         
         filter_state->w12 = filter_state->w11;
         filter_state->w11 = Tmp_f10;
         
         Tmp_f20 = x2 - a[2][1] * filter_state->w21 - a[2][2] * filter_state->w22;
         x3 = Tmp_f20 * b[2][0] + b[2][1] * filter_state->w21 + b[2][2] * filter_state->w22;

         filter_state->w22 = filter_state->w21;
         filter_state->w21 = Tmp_f20;
         
         pcmOut[i] = x3;
     }

}
